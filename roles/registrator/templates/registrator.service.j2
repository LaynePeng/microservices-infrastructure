[Unit]
Description=registrator
Documentation=https://github.com/progrium/registrator
After=docker.service
After=consul.service
Requires=docker.service
Requires=consul.service


[Service]
Restart=on-failure
RestartSec=20
TimeoutStartSec=0

ExecStartPre=-/usr/bin/docker rm {{ registrator_container_name }} 
ExecStartPre=-/usr/bin/docker pull {{ registrator_docker_image }}:{{ registrator_docker_tag }} 
ExecStart=/usr/bin/docker run \
                          --name={{ registrator_container_name }} \
                          --privileged=true \
                          --link consul:consul \
                          -v /var/run/docker.sock:/tmp/docker.sock \
                          -h {{ inventory_hostname }} \
                          {{ registrator_docker_image }}:{{ registrator_docker_tag }} {{ registrator_consul_connect }}

ExecStop=/usr/bin/docker kill {{ registrator_container_name }}

[Install]
WantedBy=multi-user.target
